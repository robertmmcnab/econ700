---
title: "Economic Analysis"
author: "Bob McNab"
format:
  html:
    toc: true
    toc-depth: 3
    toc-location: right
    self-contained: false     # must be false when using webr
urlcolor: blue
filters:
  - webr
execute:
  webR: true
---

```{r setup, echo = FALSE, message = FALSE}

library(dplyr, quietly = TRUE)
library(ggplot2, quietly = TRUE)
library(kableExtra, quietly = TRUE)
library(lubridate, quietly = TRUE)
library(tidyquant, quietly = TRUE)

```

## Data and the Challenge of Economic Analysis

We are awash in data. The challenge is to find the right data at the appropriate time to investigate an empirical question of interest. In some cases, the data are well defined, consistently formatted, readily available, and structured to facilitate analysis. Then there are data that could help answer a question, but are not in an easily accessible format. But, before tackling these problems, we need to ask the simple question:

**What are data?**

The Merriam-Webster dictionary defines data as: "...*factual information (such as measurements or statistics) used a basis for reasoning, discussion, or calculation*." Broadly speaking, data can consist of measurements regarding the health of individuals, performance of firms, the income of regions, the inflation rate of a national economy, among other things. Data can also consist of statistics that describe the properties of an underlying set of measurements.

The Bureau of Labor Statistics (BLS) defines the civilian labor force as "*The labor force includes all people age 16 and older who are classified as either [employed](https://www.bls.gov/cps/definitions.htm#employed) and [unemployed](https://www.bls.gov/cps/definitions.htm#unemployed). Conceptually, the labor force level is the number of people who are either working or actively looking for work.*"

How many people are the in the civilian labor force in the United States? How many in Virginia? Is the labor force larger today than it was at the same time last year? How does the growth in the labor force in Virginia compare to other states? All these questions require obtaining data and, for some, manipulating data to create statistics about the properties of the data.

## Headline Unemployment Rate

The headline unemployment rate is an example of a measure that has different values across time. Collectively, these measures are data on the headline unemployment rate. This rate is equal to the ratio of the employed persons in the civilian labor force to the civilian labor force.

In the following figure, we plot the evolution of the unemployment rate over time.

```{r unemp1, echo = FALSE, message = FALSE, results = 'asis', fig.height = 3, fig.width = 5, fig.align = "center"}

library(dplyr)
library(ggplot2)
library(lubridate)
library(tidyquant)

unrate <- tq_get("UNRATE",
                    get  = "economic.data",
                    from = "1939-01-01" ) %>%
          mutate(value = price/100)  %>%
          filter(year(date) > 2017) 

ggplot(data = unrate,
       aes(x = date, 
           y = value)) +
  geom_line(color = "darkblue") + 
  scale_y_continuous(labels=scales::percent_format(a=1)) +
  scale_x_date(date_labels = "%Y", 
               date_breaks="1 years") +
  theme_minimal()+
  theme(legend.position="none",
        plot.caption=element_text(hjust=0),
        plot.subtitle=element_text(size=12,face="italic",color="darkgray"),
        plot.title=element_text(size=12,face="bold",color="black")) +
  labs(x        = "",
       y        = "Unemployment Rate",
       title    = "Headline (U3) Unemployment Rate, United States",
       caption  = "Source: Bureau of Labor Statistics, seasonally adjusted data.")



```

## Unemployment by Race

Data can consist of measurements of a variable across groups of individuals and time. In the following figure, we present the headline unemployment rate by selected racial groups in the United States from February 2020 to July 2020. Unlike the national unemployment rate which encompasses all individuals in the civilian labor force, each group represents all individuals by race relative to the civilian labor force by race. We can observe how the responsiveness of the unemployment rate differed by race.

```{r unemp3, echo = FALSE, message = FALSE, results = 'asis', fig.height = 5, fig.width = 6, fig.align = "center"}

UNRATE <- tq_get(c("LNS14000003",
                   "LNS14000006",
                   "LNS14000009"),
                    get  = "economic.data",
                    from = "1939-01-01" ) %>%
          mutate(value = price/100)  %>%
          filter(date > ymd("2023-01-01")) %>%
  mutate(race = ifelse(symbol == "LNS14000003", "White",
                ifelse(symbol == "LNS14000006", "Black or African American",
                ifelse(symbol == "LNS14000009", "Hispanic", "NA"))))

chartdate <- UNRATE %>%
  mutate(month_mindate = lubridate::month(min(date), label = TRUE, abbr = FALSE),
         year_mindate  = lubridate::year(min(date)),
         month_maxdate = lubridate::month(max(date), label = TRUE, abbr = FALSE),
         year_maxdate  = lubridate::year(max(date))) %>%
  filter(date == max(date)) %>%
  mutate(title = paste0("Unemployment Rate, United States, ", month_mindate," ", year_mindate, " - ", month_maxdate," ", year_maxdate))

ggplot(data = UNRATE,
       aes(x = date, 
           y = value, 
           group = symbol, 
           fill = race)) +
geom_bar(position="dodge", stat="identity") +
scale_color_discrete(name = "symbol", 
                       breaks = c("LNS14000003", "LNS14000006", "LNS14000009"),
                       labels = c("White", "Black", "Hispanic")) +
scale_y_continuous(labels=scales::percent_format(a=1),
                   limits = c(0, 0.1)) +
facet_wrap(~race) +
theme_minimal()+
theme(legend.position="bottom",
      legend.title = element_blank(),
      legend.text = element_text(size = 10),
      legend.box.margin = margin(c(-10,-10,0,-10)),
      plot.caption=element_text(hjust=0),
      plot.subtitle=element_text(size=12,face="italic",color="darkgray"),
      plot.title=element_text(size=12,face="bold",color="black")) +
guides(colour = guide_legend(override.aes = list(size=3))) +
labs(x        = "",
     y        = "Unemployment Rate",
     title    = chartdate$title,
     subtitle = "Unemployment rate by Race and Ethnicity",
     caption  = "Source: Bureau of Labor Statistics, seasonally adjusted data.")

```

## Unemployment Rate for Selected States

In the table below, we obtain data on unemployment rates for Virginia, Maryland, North Carolina, West Virginia, and the United States from \url{https://fred.stlouisfed.org} or 'FRED'.

In the table, each row corresponds to a geography (state or nation) while each column represents a variable for that geography. Note that only the last period available is represented in the table.

```{r unemp4, echo = FALSE, message = FALSE, results = 'asis', fig.height = 5, fig.width = 8, fig.align = "center"}

UNRATE <- tq_get(c("VAUR",
                   "NCUR",
                   "WVUR",
                   "MDUR",
                   "UNRATE"),
                    get  = "economic.data",
                    from = "1939-01-01" ) %>%
          mutate(value = price/100)  %>%
          filter(date > ymd("2020-01-01")) %>%
  mutate(geography = case_when(symbol == "VAUR" ~ "Virginia",
                               symbol == "NCUR" ~ "North Carollina",
                               symbol == "WVUR" ~ "West Virginia",
                               symbol == "MDUR" ~ "Maryland",
                               TRUE ~ "United States")) %>% 
  filter(date == max(date)) 

kable(UNRATE,
      col.names = c('FRED Symbol', 'Date of Observation', "Value", "Value in Decimal Form", "Geography"),
      align     = 'c',
      caption = 'Unemployment Rate for Selected Geographies') %>%
kable_styling()

```

## Measurement

Referring to the unemployment rate, there are two rows with observations for the selected geographical areas. In other words, the \textbf{elements} are the states on which data are collected and presented in the table. There are six variables in the table: the symbol of the variable from FRED, the date of the observation, the value of the observation, the value of the observation in decimal form, and the geography name of the observation.

The table contains different scales of measurement. The \textbf{date} variable contains information on time while the \textbf{state} variable is measured on the \textbf{nominal scale}. The nominal scale is used to identify the observational data, that is, the data in the table are organized by the geographical area of the observation. The data pertaining to the unemployment rate is \textbf{ordinal data} in that the measurements contain numeric information.

Broadly speaking, data can be classified as \textbf{categorical} or \textbf{quantitative}. In the table, the variable containing the geographical names is categorical. We cannot mathematically manipulate the categorical data (subtracting 1 from Virginia does not produce a meaningful result). We could, however, create a new variable that contains numerical values to represent the categorical data, that is, the new quantitative variable would be a numerical representation of the categorical data.

## Cross-Sectional, Time Series, and Panel Data

There are three broad types of data. Let's establish some terminology. When we discuss data, we often refer to \textbf{individuals} and \textbf{time}. In this context, individuals can represent people, firms, airlines, cars, or some other characteristic that defines the unique observations. For example, if we had data on the average fuel mileage of passenger vehicles in 2019, then individuals would refer to each type of passenger vehicle. If we had randomized data on 100,000 taxpayers in Virginia for 2018, then individuals would refer to unique taxpayers. Lastly, if we collected data on airplane arrivals at Dulles International Airport for each day in 2019, then we would have individual observations across time. We could organize this data by plane registration, airline, or country of origin, or some other category of interest.

\textbf{Cross-sectional data} are data collected across individuals at the same point of time. There is no depth to cross-sectional data, that is, the data represent a snapshot at a specific point in time.

\textbf{Time series data} are data collected over several time periods. Data for the headline unemployment graph for the United States are time series data.In this context, time series data refers to one variable across time. One can have a collection of time series variables (inflation rate, unemployment rate, and so on). Time series data has depth but not breadth.

\textbf{Panel data} are data collected across individuals and time. If we collected data for the unemployment rate across states from 2010 to 2020, then we would have individuals (states) and time (months) as defining characteristics of our data. Panel data has breadth (across individuals) and depth (across time).

## Population versus Sample Data

When working with data, a question may arise whether it is appropriate to work with the population or a sample. The \textbf{population} represents all the individuals for a particular study while a \textbf{sample} is a subset of the population. Let's say we wanted to calculate the average age of students at Old Dominion University for the Fall 2020 semester. If we had access to student records, this might be a relatively easy exercise. In other words, if we had access to data for the population of students, we could calculate the average age of the student population.

Now, let's assume we wanted to calculate the average age for all college students in the United States. The problem has become more difficult. We could try and obtain all the records from all the colleges and universities in the United States but this effort might be \textbf{costly} and \textbf{difficult}. We could instead sample different colleges and universities and construct an estimate of the average age of college students. The "closer" our sample is to the population, the better our estimate of the average age of all the college students in the United States. If we only selected colleges and universities with undergraduate programs, our sample would likely understate the average age of college students. If we only selected graduate programs at colleges and universities, our sample would likely overstate the average age of college students.

The process by which we use a sample to estimate the properties of the population is \textbf{statistical inference}. Gathering a sample that is representative of the population is the first step. We then must understand the properties of the sample and how this reflects the properties of the population.

